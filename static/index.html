<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Manager Enterprise</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4F46E5; /* Indigo 600 */
            --primary-dark: #4338ca;
            --bg-body: #f8fafc;
            --sidebar-bg: #0f172a; /* Slate 900 */
            --text-main: #334155;
            --white: #ffffff;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg-body); color: var(--text-main); height: 100vh; overflow: hidden; }

        /* --- LOGIN SPLIT SCREEN (DISE√ëO NUEVO) --- */
        #vista-login {
            display: flex; height: 100vh; width: 100vw; background: white;
        }
        
        /* Mitad Izquierda: Formulario */
        .login-left {
            flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 4rem; position: relative;
        }
        .login-wrapper { width: 100%; max-width: 400px; }
        
        .brand-login { 
            font-size: 1.5rem; font-weight: 800; color: #0f172a; margin-bottom: 3rem; 
            display: flex; align-items: center; gap: 10px;
        }
        .login-title { font-size: 2rem; font-weight: 700; color: #0f172a; margin-bottom: 0.5rem; letter-spacing: -0.02em; }
        .login-subtitle { color: #64748b; margin-bottom: 2.5rem; font-size: 1rem; }

        /* Mitad Derecha: Arte Visual */
        .login-right {
            flex: 1.2; 
            background: linear-gradient(135deg, #4F46E5 0%, #06b6d4 100%);
            display: flex; flex-direction: column; justify-content: center; padding: 4rem;
            color: white; position: relative; overflow: hidden;
        }
        /* Patr√≥n decorativo CSS (C√≠rculos abstractos) */
        .login-right::before {
            content: ''; position: absolute; top: -10%; right: -10%; width: 400px; height: 400px;
            background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(60px);
        }
        .login-right::after {
            content: ''; position: absolute; bottom: -10%; left: -10%; width: 300px; height: 300px;
            background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(40px);
        }
        
        .quote-box { position: relative; z-index: 2; max-width: 500px; }
        .quote-text { font-size: 2rem; font-weight: 600; line-height: 1.3; margin-bottom: 1.5rem; }
        .quote-author { font-size: 1rem; opacity: 0.8; }

        /* INPUTS MODERNOS */
        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; font-size: 0.85rem; font-weight: 600; color: #334155; margin-bottom: 0.5rem; }
        input, select {
            width: 100%; padding: 14px 16px; border: 1px solid var(--border); border-radius: 12px;
            font-size: 1rem; transition: all 0.2s; background: #f8fafc; color: #0f172a;
        }
        input:focus, select:focus {
            outline: none; border-color: var(--primary); background: #fff;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        button.btn-primary {
            width: 100%; background: var(--primary); color: white; border: none; padding: 14px;
            border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 1rem;
        }
        button.btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); }

        /* --- DASHBOARD STYLES (Mantenemos la estructura Pro) --- */
        #vista-panel { display: flex; height: 100vh; }
        .sidebar { width: 280px; background-color: var(--sidebar-bg); color: var(--white); display: flex; flex-direction: column; padding: 2rem; flex-shrink: 0; }
        .main-content { flex: 1; padding: 2rem; overflow-y: auto; background: var(--bg-body); }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; max-width: 1600px; margin: 0 auto; }
        
        .card { background: var(--white); border-radius: 16px; padding: 2rem; border: 1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .card-title { font-size: 1.1rem; font-weight: 700; color: #0f172a; }

        .table-wrapper { overflow-y: auto; max-height: 500px; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; }
        th { position: sticky; top: 0; background: #f1f5f9; text-align: left; padding: 14px; font-size: 0.75rem; text-transform: uppercase; color: #64748b; font-weight: 700; }
        td { padding: 16px 14px; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; color: #334155; }
        
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }
        .badge.pendiente { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
        .badge.finalizado { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }
        .badge.cancelado { background: #fef2f2; color: #b91c1c; border: 1px solid #fee2e2; }

        .btn-icon { padding: 6px 10px; border-radius: 6px; border: none; cursor: pointer; font-size: 0.8rem; font-weight: 600; margin-right: 5px;}
        .btn-check { background: #dcfce7; color: #15803d; }
        .btn-cancel { background: #fee2e2; color: #b91c1c; }

        .oculto { display: none !important; }
        
        /* Mobile responsive login */
        @media (max-width: 900px) { .login-right { display: none; } }
    </style>
</head>
<body>

    <div id="vista-login">
        <div class="login-left">
            <div class="login-wrapper">
                <div class="brand-login">‚ö° TurnosApp</div>
                <h1 class="login-title">Bienvenido</h1>
                <p class="login-subtitle">Ingresa tus credenciales para acceder al panel.</p>
                
                <div class="input-group">
                    <label class="input-label">Correo Electr√≥nico</label>
                    <input type="text" id="email" placeholder="nombre@empresa.com">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Contrase√±a</label>
                    <input type="password" id="pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <button class="btn-primary" onclick="login()">Iniciar Sesi√≥n</button>
                
                <p style="margin-top: 20px; font-size: 0.85rem; color: #94a3b8; text-align: center;">
                    SaaS Multi-tenant v1.0 ‚Ä¢ Proyecto Final
                </p>
            </div>
        </div>

        <div class="login-right">
            <div class="quote-box">
                <div class="quote-text">"La gesti√≥n eficiente es la clave para escalar tu negocio al siguiente nivel."</div>
                <div class="quote-author">Sistema de Gesti√≥n Integral</div>
            </div>
        </div>
    </div>

    <div id="vista-panel" class="oculto">
        <div class="sidebar">
            <div class="brand-login" style="color:white; margin-bottom: 2rem;">
                <div id="brand-logo-area" style="display:flex; align-items:center; gap:10px;"></div>
            </div>

            <div style="flex: 1;">
                <div style="color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; font-weight: 700; margin-bottom: 15px; letter-spacing: 1px;">Menu</div>
                <div style="padding: 12px; background: rgba(255,255,255,0.1); border-radius: 10px; color: white; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                    üìä Dashboard
                </div>
            </div>

            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px;">
                <div id="sidebar-negocio" style="font-weight: 600; font-size: 0.9rem;">Cargando...</div>
                <div id="sidebar-id" style="font-size: 0.75rem; color: #94a3b8; margin-top: 5px;">ID: --</div>
                <div style="margin-top: 15px; font-size: 0.8rem; color: #f87171; cursor: pointer; font-weight: 600;" onclick="location.reload()">‚Üê Cerrar Sesi√≥n</div>
            </div>
        </div>

        <div class="main-content">
            <h1 style="font-size: 1.8rem; margin-bottom: 2rem; color: #1e293b; font-weight: 700;">Panel de Control</h1>
            
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üë• Base de Clientes</span>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e2e8f0;">
                        <input type="text" id="cli-nombre" placeholder="Nombre completo">
                        <input type="text" id="cli-tel" placeholder="Tel√©fono">
                        <button class="btn-primary" onclick="guardarCliente()">+ Nuevo Cliente</button>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead><tr><th>ID</th><th>Nombre</th><th>Contacto</th></tr></thead>
                            <tbody id="tabla-clientes"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üìÖ Agenda de Turnos</span>
                    </div>

                    <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e2e8f0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <select id="select-cliente"><option>Cargando...</option></select>
                            <input type="datetime-local" id="turno-fecha">
                        </div>
                        <input type="text" id="turno-detalle" placeholder="Detalle (ej: Corte, Service)">
                        <button class="btn-primary" onclick="guardarTurno()">Agendar Turno</button>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead><tr><th>Fecha</th><th>Cliente</th><th>Detalle</th><th>Estado</th><th>Acciones</th></tr></thead>
                            <tbody id="tabla-turnos"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userId = null;

        // LOGOS SVG
        const svgTijeras = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>`;
        const svgLlave = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>`;
        const svgDefault = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>`;

        function login() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;

            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password: pass })
            })
            .then(res => res.json())
            .then(data => {
                if(data.error) return alert("‚ùå " + data.error);
                userId = data.id;

                // Animaci√≥n de salida login
                document.getElementById('vista-login').style.opacity = '0';
                document.getElementById('vista-login').style.transition = 'opacity 0.5s';
                
                setTimeout(() => {
                    document.getElementById('vista-login').classList.add('oculto');
                    document.getElementById('vista-panel').classList.remove('oculto');
                    
                    // Config Logo y Datos
                    const nombre = data.negocio.toLowerCase();
                    let icono = svgDefault;
                    if(nombre.includes('peluqueria') || nombre.includes('peluquer√≠a')) icono = svgTijeras;
                    if(nombre.includes('taller') || nombre.includes('mec√°nica')) icono = svgLlave;

                    document.getElementById('brand-logo-area').innerHTML = `${icono} <span>${data.negocio}</span>`;
                    document.getElementById('sidebar-negocio').innerText = data.negocio;
                    document.getElementById('sidebar-id').innerText = "Usuario #" + data.id;
                    
                    cargarDatos();
                }, 500);
            });
        }

        function cargarDatos() { cargarClientes(); cargarTurnos(); }

        function cargarClientes() {
            fetch('/api/clientes', { headers: { 'User-ID': userId } })
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('tabla-clientes');
                const select = document.getElementById('select-cliente');
                tbody.innerHTML = '';
                select.innerHTML = '<option value="">Seleccionar...</option>';

                data.forEach(c => {
                    tbody.innerHTML += `<tr><td><span style="color:#94a3b8">#${c.id}</span></td><td style="font-weight:600">${c.nombre}</td><td>${c.telefono}</td></tr>`;
                    select.innerHTML += `<option value="${c.id}">${c.nombre}</option>`;
                });
            });
        }

        function guardarCliente() {
            const nombre = document.getElementById('cli-nombre').value;
            const tel = document.getElementById('cli-tel').value;
            if(!nombre) return alert("Nombre requerido");

            fetch('/api/clientes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'User-ID': userId },
                body: JSON.stringify({ nombre, telefono: tel })
            }).then(() => {
                cargarClientes();
                document.getElementById('cli-nombre').value = '';
                document.getElementById('cli-tel').value = '';
            });
        }

        function cargarTurnos() {
            fetch('/api/turnos', { headers: { 'User-ID': userId } })
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('tabla-turnos');
                tbody.innerHTML = '';

                data.forEach(t => {
                    const fechaObj = new Date(t.fecha);
                    const fechaStr = fechaObj.toLocaleString('es-AR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute:'2-digit' });

                    let estado = `<span class="badge pendiente">Pendiente</span>`;
                    let acciones = `
                        <button class="btn-icon btn-check" title="Finalizar" onclick="cambiarEstado(${t.id}, 'finalizar')">‚úì</button>
                        <button class="btn-icon btn-cancel" title="Cancelar" onclick="cambiarEstado(${t.id}, 'cancelar')">‚úï</button>
                    `;

                    if(t.estado === 'finalizado') {
                        estado = `<span class="badge finalizado">Finalizado</span>`;
                        acciones = `<span style="color:#cbd5e1">‚Äî</span>`;
                    } else if(t.estado === 'cancelado') {
                        estado = `<span class="badge cancelado">Cancelado</span>`;
                        acciones = `<span style="color:#cbd5e1">‚Äî</span>`;
                    }

                    tbody.innerHTML += `
                        <tr>
                            <td style="font-weight:600">${fechaStr}</td>
                            <td>${t.cliente}</td>
                            <td style="color:#64748b">${t.detalle}</td>
                            <td>${estado}</td>
                            <td class="actions-cell">${acciones}</td>
                        </tr>
                    `;
                });
            });
        }

        function guardarTurno() {
            const clienteId = document.getElementById('select-cliente').value;
            const fechaInput = document.getElementById('turno-fecha').value;
            const detalle = document.getElementById('turno-detalle').value;

            if(!clienteId || !fechaInput) return alert("Faltan datos");
            const fechaMySQL = fechaInput.replace('T', ' ') + ':00';

            fetch('/api/turnos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'User-ID': userId },
                body: JSON.stringify({ cliente_id: clienteId, fecha: fechaMySQL, detalle })
            }).then(() => {
                cargarTurnos();
                document.getElementById('turno-detalle').value = '';
            });
        }

        function cambiarEstado(id, accion) {
            const endpoint = accion === 'cancelar' ? 'cancelar' : 'finalizar';
            if(confirm(`¬øConfirmar acci√≥n: ${accion}?`)) {
                fetch(`/api/turnos/${id}/${endpoint}`, {
                    method: 'PUT',
                    headers: { 'User-ID': userId }
                }).then(() => cargarTurnos());
            }
        }
    </script>
</body>
</html>